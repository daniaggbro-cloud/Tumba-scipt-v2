-- üíé TUMBA MEGA SYSTEM v5 LOADER (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ Vape V4)
-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç/–∫—ç—à–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã —Å GitHub, –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ commit, —Å—Ç–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –∫—ç—à
-- –ê–≤—Ç–æ-–∑–∞–≥—Ä—É–∂–∞–µ—Ç modules –∏ config –ø–µ—Ä–µ–¥ main
-- –ó–∞–ø—É—Å—Ç–∏: loadstring(game:HttpGet("raw_url_loader.lua"))()

local OWNER_REPO = "daniaggbro-cloud/Tumba-scipt-v2"  -- –¢–æ–ª—å–∫–æ username/repo. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π —Ä–µ–ø–æ –Ω–∞ "Tumba-script-v2" –¥–ª—è —Ñ–∏–∫—Å–∞ –æ–ø–µ—á–∞—Ç–∫–∏ "scipt".
local BASE_REPO_URL = "https://github.com/" .. OWNER_REPO
local RAW_BASE_URL = "https://raw.githubusercontent.com/" .. OWNER_REPO .. "/main/"
local TUMBA_FOLDER = "tumba"
local COMMIT_FILE = TUMBA_FOLDER .. "/commit.txt"

local isfile = isfile or function(file)
    local suc, res = pcall(function()
        return readfile(file)
    end)
    return suc and res ~= nil and res ~= ''
end

local delfile = delfile or function(file)
    writefile(file, '')
end

local function downloadFile(path, func)
    local full_path = TUMBA_FOLDER .. "/" .. path:gsub("/", "_")  -- –§–∏–∫—Å –¥–ª—è –ø–æ–¥–ø–∞–ø–æ–∫ (config/settings.lua.txt ‚Üí tumba/config_settings.lua.txt –ª–æ–∫–∞–ª—å–Ω–æ)
    if not isfile(full_path) then
        local url = RAW_BASE_URL .. path
        print("üì• –ó–∞–≥—Ä—É–∑–∫–∞: " .. url)  -- –î–ª—è –æ—Ç–ª–∞–¥–∫–∏, —É–≤–∏–¥–∏—à—å –≤ –∫–æ–Ω—Å–æ–ª–∏
        local suc, res = pcall(function()
            return game:HttpGet(url, true)
        end)
        if not suc or res == '404: Not Found' then
            error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ " .. path .. ": " .. (res or "Unknown") .. ". URL: " .. url .. ". –ü—Ä–æ–≤–µ—Ä—å –∏–º—è —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å .lua.txt) –∏ —Ä–µ–ø–æ public!")
        end
        if path:find('.lua') then
            res = '--This watermark is used to delete the file if its cached, remove it to make the file persist after updates.\n' .. res
        end
        writefile(full_path, res)
    end
    return (func or readfile)(full_path)
end

local function wipeFolder(path)
    if not isfolder(path) then return end
    for _, file in listfiles(path) do
        if file:find('loader') then continue end
        if isfile(file) and readfile(file):find('--This watermark is used to delete the file if its cached, remove it to make the file persist after updates.') then
            delfile(file)
        end
    end
end

-- –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫–∏
for _, folder in {'tumba', 'tumba/config', 'tumba/modules'} do
    if not isfolder(folder) then
        makefolder(folder)
    end
end

-- –ü–æ–ª—É—á–∞–µ–º commit
local suc, subbed = pcall(function()
    return game:HttpGet(BASE_REPO_URL)
end)
if not suc then
    error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ: " .. BASE_REPO_URL .. " (private –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç? –°–¥–µ–ª–∞–π public!)")
end
local commit_pos = subbed:find('currentOid')
local commit = commit_pos and subbed:sub(commit_pos + 13, commit_pos + 52) or nil
commit = commit and #commit == 40 and commit or 'main'

if commit == 'main' or (isfile(COMMIT_FILE) and readfile(COMMIT_FILE) or '') ~= commit then
    print("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ù–æ–≤—ã–π commit " .. commit)
    wipeFolder(TUMBA_FOLDER)
    wipeFolder(TUMBA_FOLDER .. '/config')
    wipeFolder(TUMBA_FOLDER .. '/modules')
end
writefile(COMMIT_FILE, commit)

-- –ó–∞–≥—Ä—É–∂–∞–µ–º modules/config (—Å .lua.txt –¥–ª—è —Ç–≤–æ–µ–≥–æ —Ä–µ–ø–æ)
local modules_to_load = {
    "config/settings.lua.txt",
    "modules/localization.lua.txt",
    "modules/gui_builder.lua.txt",
    "modules/esp.lua.txt",
    "modules/aim_assist.lua.txt",
    "modules/kit_esp.lua.txt",
    "modules/player_manager.lua.txt",
    "modules/utilities.lua.txt"
}

for _, path in ipairs(modules_to_load) do
    downloadFile(path)
end

-- –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º main.lua.txt
print("üöÄ –ó–∞–ø—É—Å–∫ TUMBA v5...")
return loadstring(downloadFile('main.lua.txt'), 'main')()
